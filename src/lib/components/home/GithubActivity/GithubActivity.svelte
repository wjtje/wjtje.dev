<script lang="ts">
	import ActivityItem from './ActivityItem.svelte';
	import { t } from '$lib/i18n';
	import { onMount } from 'svelte';
	import { scale } from 'svelte/transition';
	import MiniPostLoader from '$lib/components/common/MiniPostLoader.svelte';
	import type { RemoteData } from '@prisma/client';

	onMount(async () => {
		// Fetch the GitHub events
		const response = await fetch(`/api/github.json`);
		const json = await response.json();

		// Set the GitHub events
		githubEvent = json;
		githubStatus = response.status;
	});

	let githubEvent: RemoteData[];
	let githubStatus: number;
</script>

{#if githubStatus == undefined}
	<MiniPostLoader />
{:else if githubStatus == 200}
	{#each githubEvent as event, i}
		<div in:scale={{ duration: 400, delay: i * 50 }}>
			<ActivityItem
				event={{
					date: event.date,
					mainTitle: JSON.parse(event.mainTitle),
					subTitle: JSON.parse(event.subTitle)
				}}
			/>
		</div>
	{/each}
{:else}
	<h3>{$t('GitHubActivity.LoadFailed', { status: githubStatus })}</h3>
{/if}
